<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Stylista</title>
  <style>
    body { margin: 0; font-family: sans-serif; background: #111; color: white; }
    #menu, #game, #result { display: none; text-align: center; }
    #menu { padding: 20px; }
    #laneCanvas { background: #333; display: block; margin: 0 auto; }
  </style>
</head>
<body>

<!-- üéµ ÈÅ∏Êõ≤ÁîªÈù¢ -->
<div id="menu">
  <h2>Stylista - ÈÅ∏Êõ≤</h2>
  <div>
    „É¶„Éº„Ç∂„ÉºÂêç: <input id="username" placeholder="Your Name">
    Áß∞Âè∑: <input id="title" placeholder="Your Title">
  </div>
  <h3>Êõ≤„É™„Çπ„Éà</h3>
  <ul id="songList"></ul>
</div>

<!-- üéÆ „Éó„É¨„Ç§ÁîªÈù¢ -->
<canvas id="laneCanvas" width="400" height="600"></canvas>
<div id="game">
  <p id="score">Score: 0</p>
  <p id="judgement">---</p>
</div>

<!-- üèÜ „É™„Ç∂„É´„Éà -->
<div id="result">
  <h2>Result</h2>
  <p id="finalScore"></p>
  <button onclick="backToMenu()">Back to Menu</button>
</div>

<script>
let songs = [
  { title: "Tutorial", file: "charts/tutorial.sla" }
];

let chart = null;
let notes = [];
let startTime = 0;
let score = 0;
let ctx = document.getElementById("laneCanvas").getContext("2d");

function loadSongs() {
  let list = document.getElementById("songList");
  songs.forEach(song => {
    let li = document.createElement("li");
    let btn = document.createElement("button");
    btn.innerText = song.title;
    btn.onclick = () => loadChart(song.file);
    li.appendChild(btn);
    list.appendChild(li);
  });
}

async function loadChart(file) {
  let res = await fetch(file);
  chart = await res.json();
  notes = chart.notes;
  startGame();
}

function startGame() {
  document.getElementById("menu").style.display = "none";
  document.getElementById("game").style.display = "block";
  score = 0;
  startTime = performance.now();
  requestAnimationFrame(gameLoop);
}

function gameLoop() {
  let now = performance.now() - startTime;
  ctx.clearRect(0,0,400,600);
  ctx.fillStyle = "#666";
  ctx.fillRect(50,0,300,600);

  notes.forEach(note => {
    let y = 600 - (note.time - now) / 3;
    ctx.fillStyle = (note.lane === "all") ? "white" : "white";
    ctx.fillRect(note.lane === "all" ? 50 : 50 + (note.lane-1)*75+25, y, 
                 note.lane === "all" ? 300 : 25, 10);
  });

  if (now < chart.events[1].time) {
    requestAnimationFrame(gameLoop);
  } else {
    endGame();
  }
}

function endGame() {
  document.getElementById("game").style.display = "none";
  document.getElementById("result").style.display = "block";
  document.getElementById("finalScore").innerText = "Score: " + score;
}

function backToMenu() {
  document.getElementById("result").style.display = "none";
  document.getElementById("menu").style.display = "block";
}

window.onload = () => {
  document.getElementById("menu").style.display = "block";
  loadSongs();
};
</script>

</body>
</html>
